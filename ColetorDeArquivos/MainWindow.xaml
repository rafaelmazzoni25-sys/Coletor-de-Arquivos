<Window x:Class="ColetorDeArquivos.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Coletor de Arquivos"
        Height="720"
        Width="1150"
        Background="#FFEEF2F7"
        WindowStartupLocation="CenterScreen">
    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVisibility" />
        <Style TargetType="ListBoxItem" x:Key="LogItemStyle">
            <Setter Property="Foreground" Value="#FFB6C6E3" />
            <Style.Triggers>
                <DataTrigger Binding="{Binding Level}" Value="Warning">
                    <Setter Property="Foreground" Value="#FFF2C744" />
                </DataTrigger>
                <DataTrigger Binding="{Binding Level}" Value="Error">
                    <Setter Property="Foreground" Value="#FFFF6B6B" />
                </DataTrigger>
            </Style.Triggers>
        </Style>
    </Window.Resources>
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="220" />
        </Grid.RowDefinitions>

        <Border Background="White"
                Margin="12"
                Padding="10"
                CornerRadius="10"
                BorderBrush="#FFCBD3E1"
                BorderThickness="1">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="2*" />
                    <ColumnDefinition Width="3*" />
                </Grid.ColumnDefinitions>

                <GroupBox Header="Pastas de origem" Margin="6">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>
                        <ListBox x:Name="RootsListBox"
                                 Grid.Column="0"
                                 ItemsSource="{Binding Roots}"
                                 SelectionMode="Extended"
                                 Margin="4"
                                 Height="150"
                                 IsEnabled="{Binding CanEditSearchParameters}" />
                        <StackPanel Grid.Column="1" Orientation="Vertical" VerticalAlignment="Stretch">
                            <Button Content="Adicionar..."
                                    Width="120"
                                    Command="{Binding AddRootCommand}" />
                            <Button Content="Remover selecionadas"
                                    Width="120"
                                    Command="{Binding RemoveRootsCommand}"
                                    CommandParameter="{Binding SelectedItems, ElementName=RootsListBox}" />
                            <Button Content="Limpar"
                                    Width="120"
                                    Command="{Binding ClearRootsCommand}" />
                        </StackPanel>
                    </Grid>
                </GroupBox>

                <StackPanel Grid.Column="1" Margin="12" VerticalAlignment="Top">
                    <GroupBox Header="Pasta de destino" Margin="0,0,0,12">
                        <DockPanel>
                            <TextBox Text="{Binding DestinationFolder, UpdateSourceTrigger=PropertyChanged}"
                                     IsReadOnly="True"
                                     Margin="4"
                                     Background="#FFFDFDFD"
                                     Foreground="#FF2D3E50"
                                     MinWidth="320"
                                     IsEnabled="{Binding CanEditSearchParameters}" />
                            <Button Content="Selecionar..."
                                    DockPanel.Dock="Right"
                                    Command="{Binding ChooseDestinationCommand}" />
                        </DockPanel>
                    </GroupBox>

                    <GroupBox Header="Extensões">
                        <StackPanel>
                            <TextBlock Text="Informe extensões separadas por vírgula ou espaço" Margin="4,0" />
                            <TextBox Text="{Binding ExtensionsText, UpdateSourceTrigger=PropertyChanged}" IsEnabled="{Binding CanEditSearchParameters}" />
                        </StackPanel>
                    </GroupBox>

                    <GroupBox Header="Opções" Margin="0,12,0,0">
                        <StackPanel>
                            <CheckBox Content="Sobrescrever arquivos existentes" IsChecked="{Binding OverwriteExisting}" IsEnabled="{Binding CanEditSearchParameters}" />
                            <CheckBox Content="Simulação (não copia)" IsChecked="{Binding DryRun}" IsEnabled="{Binding CanEditSearchParameters}" />
                            <CheckBox Content="Seguir links simbólicos" IsChecked="{Binding FollowSymlinks}" IsEnabled="{Binding CanEditSearchParameters}" />
                        </StackPanel>
                    </GroupBox>

                    <StackPanel Orientation="Horizontal" Margin="0,16,0,0" HorizontalAlignment="Right">
                        <Button Content="Iniciar busca"
                                Command="{Binding StartSearchCommand}" />
                        <Button Content="Cancelar busca"
                                Command="{Binding CancelSearchCommand}" />
                    </StackPanel>

                    <StackPanel Orientation="Horizontal" Margin="0,12,0,0" HorizontalAlignment="Right">
                        <Button Content="Copiar selecionados"
                                Command="{Binding CopySelectedCommand}" />
                        <Button Content="Copiar todos"
                                Command="{Binding CopyAllCommand}" />
                        <Button Content="Cancelar cópia"
                                Command="{Binding CancelCopyCommand}" />
                    </StackPanel>

                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center" Margin="0,16,0,0">
                        <ProgressBar Width="220"
                                     Height="12"
                                     Margin="4"
                                     IsIndeterminate="True"
                                     Visibility="{Binding IsBusy, Converter={StaticResource BoolToVisibility}}" />
                        <TextBlock Text="{Binding StatusText}" Margin="10,0" VerticalAlignment="Center" />
                    </StackPanel>
                </StackPanel>
            </Grid>
        </Border>

        <Border Grid.Row="1"
                Margin="12,0,12,12"
                Background="White"
                Padding="10"
                CornerRadius="10"
                BorderBrush="#FFCBD3E1"
                BorderThickness="1">
            <DockPanel>
                <StackPanel DockPanel.Dock="Top" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,0,0,8">
                    <Button Content="Selecionar tudo"
                            Command="{Binding SelectAllCommand}" />
                    <Button Content="Inverter seleção"
                            Command="{Binding InvertSelectionCommand}" />
                    <Button Content="Limpar resultados"
                            Command="{Binding ClearResultsCommand}" />
                </StackPanel>
                <DataGrid ItemsSource="{Binding Hits}"
                          AutoGenerateColumns="False"
                          CanUserAddRows="False"
                          CanUserDeleteRows="False"
                          IsReadOnly="False"
                          HeadersVisibility="Column"
                          SelectionMode="Extended"
                          SelectionUnit="FullRow"
                          Margin="0"
                          RowBackground="#FFF8FAFD"
                          AlternatingRowBackground="#FFEFF3F8"
                          EnableRowVirtualization="True"
                          VirtualizingPanel.IsVirtualizing="True"
                          VirtualizingPanel.VirtualizationMode="Recycling"
                          ScrollViewer.IsDeferredScrollingEnabled="True">
                    <DataGrid.Columns>
                        <DataGridTemplateColumn Header="✔" Width="50">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <CheckBox IsChecked="{Binding IsSelected, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" HorizontalAlignment="Center" />
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>
                        <DataGridTextColumn Binding="{Binding FileName}" Header="Arquivo" Width="200" IsReadOnly="True" />
                        <DataGridTextColumn Binding="{Binding RootPath}" Header="Raiz" Width="150" IsReadOnly="True" />
                        <DataGridTextColumn Binding="{Binding FullPath}" Header="Caminho completo" Width="*" IsReadOnly="True" />
                        <DataGridTextColumn Binding="{Binding SizeDisplay}" Header="Tamanho" Width="120" IsReadOnly="True" />
                        <DataGridTextColumn Binding="{Binding LastModifiedDisplay}" Header="Modificado" Width="150" IsReadOnly="True" />
                    </DataGrid.Columns>
                </DataGrid>
            </DockPanel>
        </Border>

        <Border Grid.Row="2"
                Margin="12,0,12,12"
                Background="White"
                Padding="10"
                CornerRadius="10"
                BorderBrush="#FFCBD3E1"
                BorderThickness="1">
            <DockPanel>
                <TextBlock Text="Log de atividades" FontWeight="Bold" Margin="0,0,0,6" />
                <ListBox ItemsSource="{Binding LogEntries}"
                         Background="#FF101521"
                         Foreground="#FFB6C6E3"
                         BorderThickness="0"
                         FontFamily="Consolas"
                         FontSize="12"
                         Margin="0"
                         Padding="4"
                         ItemContainerStyle="{StaticResource LogItemStyle}"
                         VirtualizingPanel.IsVirtualizing="True"
                         VirtualizingPanel.VirtualizationMode="Recycling"
                         ScrollViewer.VerticalScrollBarVisibility="Auto">
                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <TextBlock Text="{Binding FormattedMessage}" />
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                </ListBox>
            </DockPanel>
        </Border>
    </Grid>
</Window>
